name: ShobaniAI Viral Agent 24/7

on:
  schedule:
    # Runs 3 times daily at 6 AM, 2 PM, 10 PM IST (0:30, 8:30, 16:30 UTC)
    - cron: '30 0 * * *'   # 6 AM IST
    - cron: '30 8 * * *'   # 2 PM IST  
    - cron: '30 16 * * *'  # 10 PM IST
  workflow_dispatch: # Allows manual runs from Actions tab

jobs:
  post-viral-content:
    runs-on: ubuntu-latest

    steps:
      - name: üöÄ Execute ShobaniAI Viral Recipe
        run: |
          echo "üé¨ Starting viral content generation..."

          response=$(curl -s -X POST "https://backend.composio.dev/api/v3/recipe/rcp_WsEkvI_OdoZP/execute" \
            -H "x-api-key: ${{ secrets.COMPOSIO_API_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{}')

          echo "üìä Response: $response"

          # Check if successful
          if echo "$response" | grep -q '"success":true'; then
            echo "‚úÖ Viral content posted to Instagram!"
          else
            echo "‚ùå Failed to post content"
            exit 1
          fi
